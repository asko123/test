# Agent-LLM Interaction Flow - Visual Guide

## Complete Process Flow Diagram

This document explains exactly how the ReAct Agent and LLM interact during query processing.

---

## ­Ъј» The Key Concept

**The agent DOES use the LLM - in fact, it uses it MULTIPLE times per query!**

The agent is NOT separate from the LLM. The agent IS the LLM being used in an intelligent, iterative way with tools.

---

## ­ЪЊі Visual Flow: Complex Query Example

```
USER QUERY: "What would be impacted if we remove control AC-2?"
Рћѓ
Рћѓ  РћїРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћљ
Рћѓ  Рћѓ QUERY ROUTER (query_router.py)                                Рћѓ
Рћѓ  Рћѓ Analyzes: Complexity Score = 75/100                           Рћѓ
Рћѓ  Рћѓ Decision: Route to AGENT (complex query detected)             Рћѓ
Рћѓ  РћћРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћў
Рћѓ
Рќ╝
РћїРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћљ
Рћѓ STREAMLIT APP (app.py:433)                                      Рћѓ
Рћѓ agent_orchestrator.query(prompt)                                Рћѓ
РћћРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћў
Рћѓ
Рќ╝
РћїРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћљ
Рћѓ REACT AGENT (react_agent.py:84)                                 Рћѓ
Рћѓ self.agent.invoke({"messages": messages})                       Рћѓ
Рћѓ                                                                  Рћѓ
Рћѓ This triggers LangGraph's create_react_agent                     Рћѓ
Рћѓ which will call the LLM multiple times РєЊ                         Рћѓ
РћћРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћў
Рћѓ
Рќ╝
РћїРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРћљ
РЋЉ ­ЪДа LLM CALL #1: PLANNING                                        РЋЉ
РЋЉ РћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђ РЋЉ
РЋЉ File: llm_adapter.py, Line: 149                                 РЋЉ
РЋЉ Code: response = self._llm.invoke(prompt)                       РЋЉ
РЋЉ                                                                  РЋЉ
РЋЉ LLM Receives:                                                    РЋЉ
РЋЉ - System prompt (defines agent role and capabilities)           РЋЉ
РЋЉ - Tool descriptions (9 tools with usage instructions)           РЋЉ
РЋЉ - User query: "What would be impacted if we remove AC-2?"       РЋЉ
РЋЉ                                                                  РЋЉ
РЋЉ LLM Thinks:                                                      РЋЉ
РЋЉ "To analyze impact, I first need to find the AC-2 entity        РЋЉ
РЋЉ  in the knowledge graph. I'll use the search_entities tool."    РЋЉ
РЋЉ                                                                  РЋЉ
РЋЉ LLM Outputs:                                                     РЋЉ
РЋЉ {                                                                РЋЉ
РЋЉ   "action": "search_entities",                                  РЋЉ
РЋЉ   "action_input": {                                             РЋЉ
РЋЉ     "value_pattern": "AC-2"                                     РЋЉ
РЋЉ   }                                                              РЋЉ
РЋЉ }                                                                РЋЉ
РЋџРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋЮ
Рћѓ
Рќ╝
РћїРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћљ
Рћѓ ­ЪћД TOOL EXECUTION #1                                            Рћѓ
Рћѓ РћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђ Рћѓ
Рћѓ File: agent_tools.py                                            Рћѓ
Рћѓ Tool: search_entities(value_pattern="AC-2")                     Рћѓ
Рћѓ                                                                  Рћѓ
Рћѓ Executes:                                                        Рћѓ
Рћѓ - Searches knowledge graph for entities matching "AC-2"         Рћѓ
Рћѓ - Finds: CONTROL_AC-2 (Account Management)                      Рћѓ
Рћѓ                                                                  Рћѓ
Рћѓ Returns:                                                         Рћѓ
Рћѓ {                                                                Рћѓ
Рћѓ   "count": 1,                                                   Рћѓ
Рћѓ   "entities": [{                                                Рћѓ
Рћѓ     "id": "CONTROL_AC-2",                                       Рћѓ
Рћѓ     "type": "CONTROL",                                          Рћѓ
Рћѓ     "value": "AC-2",                                            Рћѓ
Рћѓ     "source": "security_policy.pdf"                             Рћѓ
Рћѓ   }]                                                             Рћѓ
Рћѓ }                                                                Рћѓ
РћћРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћў
Рћѓ
Рќ╝
РћїРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРћљ
РЋЉ ­ЪДа LLM CALL #2: INTERPRET & PLAN NEXT                          РЋЉ
РЋЉ РћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђ РЋЉ
РЋЉ File: llm_adapter.py, Line: 149                                 РЋЉ
РЋЉ Code: response = self._llm.invoke(prompt)                       РЋЉ
РЋЉ                                                                  РЋЉ
РЋЉ LLM Receives:                                                    РЋЉ
РЋЉ - Previous context (query + tool action + result)               РЋЉ
РЋЉ - Tool result: Found CONTROL_AC-2                               РЋЉ
РЋЉ                                                                  РЋЉ
РЋЉ LLM Thinks:                                                      РЋЉ
РЋЉ "Good! I found AC-2. Now I need to find what's connected to     РЋЉ
РЋЉ  it - what entities have relationships with AC-2? I'll use      РЋЉ
РЋЉ  get_entity_relationships to find all connected entities."      РЋЉ
РЋЉ                                                                  РЋЉ
РЋЉ LLM Outputs:                                                     РЋЉ
РЋЉ {                                                                РЋЉ
РЋЉ   "action": "get_entity_relationships",                         РЋЉ
РЋЉ   "action_input": {                                             РЋЉ
РЋЉ     "entity_id": "CONTROL_AC-2",                                РЋЉ
РЋЉ     "max_depth": 1                                              РЋЉ
РЋЉ   }                                                              РЋЉ
РЋЉ }                                                                РЋЉ
РЋџРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋЮ
Рћѓ
Рќ╝
РћїРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћљ
Рћѓ ­ЪћД TOOL EXECUTION #2                                            Рћѓ
Рћѓ РћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђ Рћѓ
Рћѓ File: agent_tools.py                                            Рћѓ
Рћѓ Tool: get_entity_relationships("CONTROL_AC-2", max_depth=1)    Рћѓ
Рћѓ                                                                  Рћѓ
Рћѓ Executes:                                                        Рћѓ
Рћѓ - Traverses graph to find all entities connected to AC-2        Рћѓ
Рћѓ - Finds relationships: MITIGATES, IMPLEMENTS, APPLIES_TO        Рћѓ
Рћѓ                                                                  Рћѓ
Рћѓ Returns:                                                         Рћѓ
Рћѓ {                                                                Рћѓ
Рћѓ   "source_entity": "CONTROL_AC-2",                              Рћѓ
Рћѓ   "total_related": 12,                                          Рћѓ
Рћѓ   "relationships": [                                             Рћѓ
Рћѓ     {                                                            Рћѓ
Рћѓ       "related_id": "RISK_R-001",                               Рћѓ
Рћѓ       "related_type": "RISK",                                   Рћѓ
Рћѓ       "relationship_type": "MITIGATES",                         Рћѓ
Рћѓ       "direction": "outgoing"                                   Рћѓ
Рћѓ     },                                                           Рћѓ
Рћѓ     {                                                            Рћѓ
Рћѓ       "related_id": "ASSET_database_servers",                   Рћѓ
Рћѓ       "related_type": "ASSET",                                  Рћѓ
Рћѓ       "relationship_type": "APPLIES_TO",                        Рћѓ
Рћѓ       "direction": "outgoing"                                   Рћѓ
Рћѓ     },                                                           Рћѓ
Рћѓ     {                                                            Рћѓ
Рћѓ       "related_id": "REQUIREMENT_REQ-123",                      Рћѓ
Рћѓ       "related_type": "REQUIREMENT",                            Рћѓ
Рћѓ       "relationship_type": "IMPLEMENTS",                        Рћѓ
Рћѓ       "direction": "outgoing"                                   Рћѓ
Рћѓ     },                                                           Рћѓ
Рћѓ     ... 9 more entities                                         Рћѓ
Рћѓ   ]                                                              Рћѓ
Рћѓ }                                                                Рћѓ
РћћРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћў
Рћѓ
Рќ╝
РћїРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРћљ
РЋЉ ­ЪДа LLM CALL #3: ASSESS & CONTINUE PLANNING                     РЋЉ
РЋЉ РћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђ РЋЉ
РЋЉ File: llm_adapter.py, Line: 149                                 РЋЉ
РЋЉ Code: response = self._llm.invoke(prompt)                       РЋЉ
РЋЉ                                                                  РЋЉ
РЋЉ LLM Receives:                                                    РЋЉ
РЋЉ - Full conversation history                                      РЋЉ
РЋЉ - List of 12 connected entities                                 РЋЉ
РЋЉ                                                                  РЋЉ
РЋЉ LLM Thinks:                                                      РЋЉ
РЋЉ "I found 12 directly connected entities, but for a complete     РЋЉ
РЋЉ  impact analysis, I need to check for downstream dependencies.  РЋЉ
РЋЉ  Some of these entities might have their own dependencies that  РЋЉ
РЋЉ  would also be affected. Let me use traverse_graph for a        РЋЉ
РЋЉ  deeper analysis with depth=2 to capture cascading impacts."    РЋЉ
РЋЉ                                                                  РЋЉ
РЋЉ LLM Outputs:                                                     РЋЉ
РЋЉ {                                                                РЋЉ
РЋЉ   "action": "traverse_graph",                                   РЋЉ
РЋЉ   "action_input": {                                             РЋЉ
РЋЉ     "start_entity_id": "CONTROL_AC-2",                          РЋЉ
РЋЉ     "max_depth": 2                                              РЋЉ
РЋЉ   }                                                              РЋЉ
РЋЉ }                                                                РЋЉ
РЋџРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋЮ
Рћѓ
Рќ╝
РћїРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћљ
Рћѓ ­ЪћД TOOL EXECUTION #3                                            Рћѓ
Рћѓ РћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђ Рћѓ
Рћѓ File: agent_tools.py                                            Рћѓ
Рћѓ Tool: traverse_graph("CONTROL_AC-2", max_depth=2)              Рћѓ
Рћѓ                                                                  Рћѓ
Рћѓ Executes:                                                        Рћѓ
Рћѓ - BFS traversal from AC-2                                       Рћѓ
Рћѓ - Depth 1: 12 entities (direct connections)                     Рћѓ
Рћѓ - Depth 2: 23 additional entities (downstream dependencies)     Рћѓ
Рћѓ                                                                  Рћѓ
Рћѓ Returns:                                                         Рћѓ
Рћѓ {                                                                Рћѓ
Рћѓ   "start_entity": "CONTROL_AC-2",                               Рћѓ
Рћѓ   "max_depth": 2,                                               Рћѓ
Рћѓ   "entities_discovered": 35,                                    Рћѓ
Рћѓ   "entities": [                                                 Рћѓ
Рћѓ     { depth: 0, id: "CONTROL_AC-2", ... },                      Рћѓ
Рћѓ     { depth: 1, id: "RISK_R-001", type: "RISK", ... },         Рћѓ
Рћѓ     { depth: 1, id: "ASSET_database_servers", ... },           Рћѓ
Рћѓ     { depth: 2, id: "POLICY_POL-005", ... },                   Рћѓ
Рћѓ     { depth: 2, id: "STANDARD_ISO_27001", ... },               Рћѓ
Рћѓ     ... 30 more entities with full dependency tree             Рћѓ
Рћѓ   ]                                                              Рћѓ
Рћѓ }                                                                Рћѓ
РћћРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћў
Рћѓ
Рќ╝
РћїРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРћљ
РЋЉ ­ЪДа LLM CALL #4: FINAL SYNTHESIS                                РЋЉ
РЋЉ РћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђ РЋЉ
РЋЉ File: llm_adapter.py, Line: 149                                 РЋЉ
РЋЉ Code: response = self._llm.invoke(prompt)                       РЋЉ
РЋЉ                                                                  РЋЉ
РЋЉ LLM Receives:                                                    РЋЉ
РЋЉ - Complete conversation history                                 РЋЉ
РЋЉ - AC-2 entity details                                           РЋЉ
РЋЉ - 12 direct relationships                                       РЋЉ
РЋЉ - 35 total entities in dependency tree                          РЋЉ
РЋЉ - Depth-2 traversal results                                     РЋЉ
РЋЉ                                                                  РЋЉ
РЋЉ LLM Thinks:                                                      РЋЉ
РЋЉ "Perfect! I now have comprehensive information:                 РЋЉ
РЋЉ  - What AC-2 is and does                                        РЋЉ
РЋЉ  - What it directly connects to (depth 1)                       РЋЉ
РЋЉ  - What would be cascading impacted (depth 2)                   РЋЉ
РЋЉ                                                                  РЋЉ
РЋЉ  I can now synthesize a complete impact analysis report."       РЋЉ
РЋЉ                                                                  РЋЉ
РЋЉ LLM Outputs:                                                     РЋЉ
РЋЉ [FINAL COMPREHENSIVE ANSWER - FULL TEXT RESPONSE]               РЋЉ
РЋЉ                                                                  РЋЉ
РЋЉ "Removing control AC-2 (Account Management) would have          РЋЉ
РЋЉ  significant impacts across multiple layers:                    РЋЉ
РЋЉ                                                                  РЋЉ
РЋЉ  IMMEDIATE IMPACTS:                                              РЋЉ
РЋЉ  1. Risk R-001 (Unauthorized Access) - HIGH severity            РЋЉ
РЋЉ     - Currently mitigated by AC-2                               РЋЉ
РЋЉ     - Would become uncontrolled risk                            РЋЉ
РЋЉ                                                                  РЋЉ
РЋЉ  2. Database Servers (ASSET)                                     РЋЉ
РЋЉ     - Would lose primary access control mechanism               РЋЉ
РЋЉ     - 15 production databases affected                          РЋЉ
РЋЉ                                                                  РЋЉ
РЋЉ  3. Requirement REQ-123 - Compliance Mandate                     РЋЉ
РЋЉ     - Would no longer be satisfied                              РЋЉ
РЋЉ     - Creates regulatory gap                                    РЋЉ
РЋЉ                                                                  РЋЉ
РЋЉ  DOWNSTREAM IMPACTS:                                             РЋЉ
РЋЉ  4. Policy POL-005 (Access Management Policy)                   РЋЉ
РЋЉ     - References AC-2 as implementation method                  РЋЉ
РЋЉ     - Policy would have no enforcement mechanism                РЋЉ
РЋЉ                                                                  РЋЉ
РЋЉ  5. ISO 27001 Certification (STANDARD)                           РЋЉ
РЋЉ     - Control A.9.2.1 requirement would be unmet                РЋЉ
РЋЉ     - Could affect certification status                         РЋЉ
РЋЉ                                                                  РЋЉ
РЋЉ  [... detailed analysis continues ...]                          РЋЉ
РЋЉ                                                                  РЋЉ
РЋЉ  TOTAL AFFECTED ENTITIES: 35                                     РЋЉ
РЋЉ  - 8 High-severity risks                                        РЋЉ
РЋЉ  - 15 Critical assets                                           РЋЉ
РЋЉ  - 7 Compliance requirements                                    РЋЉ
РЋЉ  - 5 Related policies                                           РЋЉ
РЋЉ                                                                  РЋЉ
РЋЉ  RECOMMENDATION: Do not remove AC-2 without establishing        РЋЉ
РЋЉ  compensating controls for all identified impacts."             РЋЉ
РЋџРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋЮ
Рћѓ
Рќ╝
РћїРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћљ
Рћѓ RESPONSE RETURNED TO USER                                       Рћѓ
Рћѓ РћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђ Рћѓ
Рћѓ File: react_agent.py - Extracts final response                 Рћѓ
Рћѓ File: app.py - Displays to user with "­Ъцќ Agent Mode" badge     Рћѓ
Рћѓ                                                                  Рћѓ
Рћѓ User sees comprehensive impact analysis with:                   Рћѓ
Рћѓ - Clear categorization of impacts                               Рћѓ
Рћѓ - Evidence from knowledge graph                                 Рћѓ
Рћѓ - Quantified risk assessment                                    Рћѓ
Рћѓ - Actionable recommendations                                    Рћѓ
Рћѓ                                                                  Рћѓ
Рћѓ Optional: Reasoning trace shows all 4 LLM calls + 3 tool uses   Рћѓ
РћћРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћў
```

---

## ­ЪћЇ Key Code Locations

### Where LLM is Called (The Critical Line)

**File:** `llm_adapter.py`  
**Line:** 149

```python
response = self._llm.invoke(prompt)  # Рєљ YOUR GOLDMAN SACHS LLM IS CALLED HERE
```

**This single line is executed 4-10+ times during agent execution!**

### Where Agent Gets the LLM

**File:** `react_agent.py`  
**Lines:** 51-55

```python
# Agent is created WITH the LLM
self.agent = create_react_agent(
    model=llm_adapter,  # Рєљ This wraps your GS LLM
    tools=self.tools,   # Рєљ 9 specialized tools
    state_modifier=self.system_prompt
)
```

### Where Agent Execution Starts

**File:** `react_agent.py`  
**Line:** 84

```python
result = self.agent.invoke(
    {"messages": messages},
    config={"recursion_limit": self.max_iterations}
)
```

**This line triggers the entire iterative LLM Рєњ Tool Рєњ LLM Рєњ Tool loop!**

---

## ­ЪЊі Comparison: Simple vs Agent Flow

### Simple Flow (1 LLM Call)
```
User Query
    РєЊ
Build Enhanced Prompt (with KG context)
    РєЊ
­ЪДа LLM.invoke(prompt)  Рєљ 1 CALL
    РєЊ
Response
```

**Total LLM Calls:** 1  
**Processing Time:** 2-3 seconds  
**Best For:** Direct questions with straightforward answers

### Agent Flow (4-10+ LLM Calls)
```
User Query
    РєЊ
­ЪДа LLM: "What should I do?" Рєљ CALL #1
    РєЊ
­ЪћД Tool Execution #1
    РєЊ
­ЪДа LLM: "What next?" Рєљ CALL #2
    РєЊ
­ЪћД Tool Execution #2
    РєЊ
­ЪДа LLM: "Continue?" Рєљ CALL #3
    РєЊ
­ЪћД Tool Execution #3
    РєЊ
­ЪДа LLM: "Final answer" Рєљ CALL #4
    РєЊ
Response
```

**Total LLM Calls:** 4-10+  
**Processing Time:** 5-15 seconds  
**Best For:** Complex multi-step reasoning, impact analysis, gap detection

---

## ­ЪњА The Big Insight

**The agent is NOT a replacement for the LLM.**  
**The agent is the LLM used in a smarter, iterative way!**

### Think of it this way:

**Simple Mode:**  
You give the LLM a huge textbook and ask, "Find information about topic X."  
The LLM reads everything once and answers.

**Agent Mode:**  
You give the LLM tools and say, "Use these tools to thoroughly research topic X."  
The LLM:
1. Uses a tool to search for relevant information
2. Reads the results
3. Decides what to look for next
4. Uses another tool
5. Combines all findings
6. Provides a comprehensive answer

**Same LLM. Just used iteratively with tools instead of all-at-once.**

---

## ­Ъј» Summary

| Aspect | Simple Flow | Agent Flow |
|--------|-------------|------------|
| **LLM Used** | РюЁ Yes (1 call) | РюЁ Yes (4-10+ calls) |
| **Tools Used** | РЮї No | РюЁ Yes (9 tools) |
| **Iterations** | 1 | 4-10+ |
| **Time** | 2-3 sec | 5-15 sec |
| **Best For** | Simple queries | Complex analysis |
| **Thoroughness** | Good | Excellent |
| **Self-Correction** | РЮї No | РюЁ Yes |

---

## ­ЪЊџ Related Documentation

- **Quick Start:** `AGENT_QUICK_START.md`
- **Implementation Details:** `AGENT_IMPLEMENTATION_SUMMARY.md`
- **Full Guide:** `README.md`
- **Code Reference:** See files mentioned in flow diagram

---

**Remember:** The agent makes your LLM smarter by giving it tools and letting it think step-by-step, not by replacing it!

